"use strict";angular.module("sandboxFluxApp",["ngAnimate","ngCookies","ngMaterial","ngResource","ngRoute","ngSanitize","ngTouch","chart.js"]).constant("ACTIONS",{COUNTRY_SELECT:"country-select",COUNTRY_UPDATE:"country-update",TOPIC_UPDATE:"poll-update"}).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/"})}]).config(["$mdThemingProvider",function(a){a.theme("default")}]).config(function(){Parse.initialize("1HjpKS0k6054RdvGjmEwFtCbglfycTkTIqd1k22y","BTXQ11uqQEtihjZAIGMxUr8ZSdVJKXn8KadbC0iJ")}),angular.module("sandboxFluxApp").controller("MainCtrl",["$scope","$http","CountryStore",function(a,b,c){var d="http://api.worldbank.org/countries/{countries}/indicators/{indicator}",e="1w",f="SP.POP.TOTL";a.countries=[e],a.series=[e+" "+f],a.data=[],a.labels=[];var g=function(){a.countries=c.selected||e;var g=d.replace("{countries}",a.countries.join(";")||e).replace("{indicator}",f);b.jsonp(g,{params:{format:"jsonp",per_page:100,prefix:"JSON_CALLBACK"}}).then(function(b){var c=_(b.data[1]).filter("value").filter(function(a){return a.date%5===0}).sortBy("date").groupBy("country.id").value();a.series=_.map(c,function(a,b){return b+" "+f}),a.data=_.map(c,function(a){return _.map(_.pluck(a,"value"),Number)}),a.labels=_.pluck(_.values(c)[0],"date")})["catch"](console.error.bind(console))},h=[c.addListener(g)];a.$on("$destroy",function(){_.forEach(h,function(a){a.remove()})})}]),angular.module("sandboxFluxApp").controller("AboutCtrl",function(){}),angular.module("sandboxFluxApp").factory("dispatcher",function(){return new Flux.Dispatcher}),angular.module("sandboxFluxApp").controller("NavigationCtrl",["$scope","$location","$timeout","$mdSidenav",function(a,b,c,d){a.toggleNavigation=_.debounce(function(){c(function(){d("navigation").toggle()})},200),a.isActive=function(a){return a===b.path()},a.openMenu=function(a,b){a(b)}}]),angular.module("sandboxFluxApp").factory("Store",["$timeout","dispatcher",function(a,b){var c=function(){this.__callbacks=[],this.__type="Store"};return c.prototype.init=function(){this.dispatchToken=b.register(this.__handler.bind(this))},c.prototype.addListener=function(a){return this.__callbacks.push(a),this.__createToken(a)},c.prototype.getDispatcher=function(){return b},c.prototype.__handler=function(){throw new Error("Store::__handler() not implemented.")},c.prototype.__emitChange=function(){var b=this.__callbacks;a(function(){b.forEach(function(a){a()})})},c.prototype.__createToken=function(a){var b=this.__callbacks;return{remove:function(){_.pull(b,a)}}},c}]),angular.module("sandboxFluxApp").factory("TopicStore",["Store","ACTIONS",function(a,b){var c=Parse.Object.extend("Topic"),d=function(){a.call(this),this.__type="TopicStore",this.topics=[],this.init()};d.prototype=new a,d.constructor=d,d.prototype.__handler=function(a){switch(a.actionType){case b.TOPIC_UPDATE:this.topics=a.topics;break;default:return}this.__emitChange()};var e=new d,f=new Parse.Query(c);return f.find({success:function(a){e.getDispatcher().dispatch({actionType:b.TOPIC_UPDATE,topics:a})},error:console.error.bind(console)}),e}]),angular.module("sandboxFluxApp").factory("CountryStore",["Store","ACTIONS",function(a,b){var c=Parse.Object.extend("Country"),d=function(){a.call(this),this.__type="CountryStore",this.countries=[],this.selected=[],this.init()};d.prototype=new a,d.constructor=d,d.prototype.__handler=function(a){switch(a.actionType){case b.COUNTRY_UPDATE:this.countries=a.countries;break;case b.COUNTRY_SELECT:this.selected=a.selected;break;default:return}this.__emitChange()};var e=new d,f=new Parse.Query(c);return f.find({success:function(a){e.getDispatcher().dispatch({actionType:b.COUNTRY_UPDATE,countries:_.filter(a,"attributes.location")})},error:console.error.bind(console)}),e}]),angular.module("sandboxFluxApp").controller("SidebarCtrl",["$scope","TopicStore","CountryStore","ACTIONS",function(a,b,c,d){a.topics=b.topics,a.countries=c.countries,a.selectedTopic="",a.selectedCountries="",a.onCountryChange=function(){c.getDispatcher().dispatch({actionType:d.COUNTRY_SELECT,selected:a.selectedCountries})};var e=[b.addListener(function(){a.topics=b.topics}),c.addListener(function(){a.countries=c.countries})];a.$on("$destroy",function(){_.forEach(e,function(a){a.remove()})})}]),angular.module("sandboxFluxApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is the about view.</p>"),a.put("views/main.html",'<div class="row"> <canvas class="chart chart-line" chart-data="data" chart-labels="labels" chart-series="series" chart-legend="true" chart-options="{\n					scaleBeginAtZero: true,\n					scaleShowVerticalLines: false\n				}"></canvas> </div>'),a.put("views/sidebar.html",'<div ng-controller="SidebarCtrl"> <md-toolbar class="md-theme-indigo"> <h1 class="md-toolbar-tools">Topics</h1> </md-toolbar> <md-content layout-padding> <md-input-container class="md-input-container"> <label>Topic</label> <md-select ng-model="selectedTopic" disabled aria-label="Select topic"> <md-option ng-repeat="topic in topics" value="{{topic.get(\'key\')}}"> {{topic.get(\'value\')}} </md-option> </md-select> </md-input-container> </md-content> <md-toolbar class="md-theme-indigo"> <h1 class="md-toolbar-tools">Countries</h1> </md-toolbar> <md-content layout-padding> <md-input-container class="md-input-container"> <label>Country</label> <md-select ng-model="selectedCountries" ng-change="onCountryChange()" multiple aria-label="Select country"> <md-option ng-repeat="country in countries" value="{{country.get(\'key\')}}"> {{country.get(\'name\')}} </md-option> </md-select> </md-input-container> </md-content> </div>')}]);